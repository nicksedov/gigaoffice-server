prompt: |
  Ты — виртуальный ассистент для преобразования и очистки данных в электронных таблицах Р7-Офис.
  Ты получаешь данные в формате JSON, который включает структурированную информацию о таблице.
  Твоя задача - выполнить указанные пользователем операции по очистке, нормализации и преобразованию данных.
  
  Всегда предоставляй результат в формате расширенных данных таблицы, сохраняя структуру JSON.
  При обработке запросов пользователя следуй инструкциям и применяй соответствующие преобразования.
  
  При работе с данными используй следующие операции:
  - Удаление дубликатов
  - Очистка от лишних пробелов
  - Преобразование типов данных
  - Нормализация форматов (даты, числа, текст)
  - Объединение и разделение полей
  - Сортировка данных

examples:
- request: |
    ЗАДАЧА: Удали дубликаты строк и отсортируй данные по дате
    
    РАСШИРЕННЫЕ ДАННЫЕ ТАБЛИЦЫ:
    {
      "metadata": {
        "version": "1.0"
      },
      "worksheet": {
        "name": "Заказы",
        "range": "A1:C8"
      },
      "data": {
        "header": {
          "values": ["Дата", "Клиент", "Сумма"]
        },
        "rows": [
          {
            "values": ["01.01.2024", "Клиент A", 15000]
          },
          {
            "values": ["02.01.2024", "Клиент B", 8000]
          },
          {
            "values": ["01.01.2024", "Клиент A", 15000]
          },
          {
            "values": ["03.01.2024", "Клиент C", 12000]
          },
          {
            "values": ["02.01.2024", "Клиент B", 8000]
          },
          {
            "values": ["04.01.2024", "Клиент D", 21000]
          }
        ]
      },
      "columns": [
        {
          "index": 0,
          "format": "dd/mm/yyyy"
        },
        {
          "index": 1,
          "format": "General"
        },
        {
          "index": 2,
          "format": "#,##0.00"
        }
      ]
    }
  response: |
    {
      "metadata": {
        "version": "1.0"
      },
      "worksheet": {
        "name": "Заказы",
        "range": "A1:C5"
      },
      "styles": [
        {
          "id": "sorted_header_style",
          "background_color": "#E8F4FD",
          "font_color": "#1F4E79",
          "font_weight": "bold"
        },
        {
          "id": "deduplicated_row_style",
          "background_color": "#F0F8FF"
        }
      ],
      "data": {
        "header": {
          "values": ["Дата", "Клиент", "Сумма"],
          "style": "sorted_header_style"
        },
        "rows": [
          {
            "values": ["01.01.2024", "Клиент A", 15000],
            "style": "deduplicated_row_style"
          },
          {
            "values": ["02.01.2024", "Клиент B", 8000],
            "style": "deduplicated_row_style"
          },
          {
            "values": ["03.01.2024", "Клиент C", 12000],
            "style": "deduplicated_row_style"
          },
          {
            "values": ["04.01.2024", "Клиент D", 21000],
            "style": "deduplicated_row_style"
          }
        ]
      },
      "columns": [
        {
          "index": 0,
          "format": "dd/mm/yyyy"
        },
        {
          "index": 1,
          "format": "General"
        },
        {
          "index": 2,
          "format": "#,##0.00"
        }
      ]
    }
- request: |
    ЗАДАЧА: Преобразуй даты в формат ДД.ММ.ГГГГ и числа в формат #,##0.00
    
    РАСШИРЕННЫЕ ДАННЫЕ ТАБЛИЦЫ:
    {
      "metadata": {
        "version": "1.0"
      },
      "worksheet": {
        "name": "Финансы",
        "range": "A1:C5"
      },
      "data": {
        "header": {
          "values": ["Дата", "Описание", "Сумма"]
        },
        "rows": [
          {
            "values": ["2024-01-01", "Продажа", "15000"]
          },
          {
            "values": ["2024-01-02", "Покупка", "-8000.5"]
          },
          {
            "values": ["2024-01-03", "Оплата", "-3000"]
          }
        ]
      },
      "columns": [
        {
          "index": 0,
          "format": "dd/mm/yyyy"
        },
        {
          "index": 1,
          "format": "General"
        },
        {
          "index": 2,
          "format": "General"
        }
      ]
    }
  response: |
    {
      "metadata": {
        "version": "1.0"
      },
      "worksheet": {
        "name": "Финансы",
        "range": "A1:C5"
      },
      "styles": [
        {
          "id": "conversion_header_style",
          "background_color": "#E8F5E8",
          "font_color": "#2D5A2D",
          "font_weight": "bold"
        },
        {
          "id": "converted_value_style",
          "background_color": "#F0FFF0",
          "font_style": "italic"
        }
      ],
      "data": {
        "header": {
          "values": ["Дата", "Описание", "Сумма"],
          "style": "conversion_header_style"
        },
        "rows": [
          {
            "values": ["01.01.2024", "Продажа", 15000.00],
            "style": "converted_value_style"
          },
          {
            "values": ["02.01.2024", "Покупка", -8000.50],
            "style": "converted_value_style"
          },
          {
            "values": ["03.01.2024", "Оплата", -3000.00],
            "style": "converted_value_style"
          }
        ]
      },
      "columns": [
        {
          "index": 0,
          "format": "dd/mm/yyyy"
        },
        {
          "index": 1,
          "format": "General"
        },
        {
          "index": 2,
          "format": "#,##0.00"
        }
      ]
    }
- request: |
    ЗАДАЧА: Объедини поля "Имя" и "Фамилия" в одно поле "Полное имя" и удалите исходные поля
    
    РАСШИРЕННЫЕ ДАННЫЕ ТАБЛИЦЫ:
    {
      "metadata": {
        "version": "1.0"
      },
      "worksheet": {
        "name": "Клиенты",
        "range": "A1:D5"
      },
      "data": {
        "header": {
          "values": ["Имя", "Фамилия", "Email", "Телефон"]
        },
        "rows": [
          {
            "values": ["Иван", "Иванов", "ivan@example.com", "+71234567890"]
          },
          {
            "values": ["Петр", "Петров", "petr@example.com", "+70987654321"]
          },
          {
            "values": ["Сидор", "Сидоров", "sidor@example.com", "+71112223344"]
          }
        ]
      },
      "columns": [
        {
          "index": 0,
          "format": "General"
        },
        {
          "index": 1,
          "format": "General"
        },
        {
          "index": 2,
          "format": "General"
        },
        {
          "index": 3,
          "format": "General"
        }
      ]
    }
  response: |
    {
      "metadata": {
        "version": "1.0"
      },
      "worksheet": {
        "name": "Клиенты",
        "range": "A1:C5"
      },
      "styles": [
        {
          "id": "merge_header_style",
          "background_color": "#FFF2E8",
          "font_color": "#8B4513",
          "font_weight": "bold"
        },
        {
          "id": "merged_field_style",
          "background_color": "#FFFAF0",
          "horizontal_alignment": "left"
        }
      ],
      "data": {
        "header": {
          "values": ["Полное имя", "Email", "Телефон"],
          "style": "merge_header_style"
        },
        "rows": [
          {
            "values": ["Иванов Иван", "ivan@example.com", "+71234567890"],
            "style": "merged_field_style"
          },
          {
            "values": ["Петров Петр", "petr@example.com", "+70987654321"],
            "style": "merged_field_style"
          },
          {
            "values": ["Сидоров Сидор", "sidor@example.com", "+71112223344"],
            "style": "merged_field_style"
          }
        ]
      },
      "columns": [
        {
          "index": 0,
          "format": "General"
        },
        {
          "index": 1,
          "format": "General"
        },
        {
          "index": 2,
          "format": "General"
        }
      ]
    }
- request: |
    {
      "spreadsheet_data": {
        "metadata": {
          "version": "1.0",
          "created_at": "2025-10-05T09:46:57.309Z"
        },
        "worksheet": {
          "name": "Лист2",
          "range": "A1:I6"
        },
        "data": {
          "header": {
            "values": ["Имя", "Фамилия", "Должность", "Отдел", "Зарплата", "Дата приема", "Возраст", "Образование", "Стаж"],
            "style": "style_2"
          },
          "rows": [
            {
              "values": ["Евгений", "Онегин", "Менеджер", "Продажи", "85000", "12.06.2018", "29", "Магистр", "6"], 
              "style": "style_1"
            },
            {
              "values": ["Анна", "Каренина", "HR‑специалист", "HR", "65000", "03.09.2020", "27", "Бакалавр", "4"],
              "style": "style_1"
            }, 
            {
              "values": ["Родион", "Раскольников", "Финансовый аналитик", "Бухгалтерия", "90000", "17.01.2016", "33", "Магистр", "9"],
              "style": "style_1"
            },
            {
              "values": ["Гарри", "Поттер", "Руководитель проекта", "ИТ", "110000", "27.11.2014", "39", "Доктор наук", "11"],
              "style": "style_1"
            },
            {
              "values": ["Джейн", "Эйр", "UI/UX дизайнер", "Дизайн", "70000", "22.04.2019", "30", "Специалист", "5"],
              "style": "style_1"
            }
          ]
        },
        "columns": [
          {
            "index": 0,
            "format": "General"
          },
          {
            "index": 1,
            "format": "General"
          },
          {
            "index": 2,
            "format": "General"
          },
          {
            "index": 3,
            "format": "General"
          },
          {
            "index": 4,
            "format": "#,##0.00"
          },
          {
            "index": 5,
            "format": "dd/mm/yyyy"
          },
          {
            "index": 6,
            "format": "#,##0"
          },
          {
            "index": 7,
            "format": "General"
          },
          {
            "index": 8,
            "format": "#,##0"
          }
        ],
        "charts": [],
        "styles": [
          {
            "id": "style_1",
            "font_weight": "normal",
            "font_style": "normal",
            "font_size": 11
          },
          {
            "id": "style_2",
            "background_color": "#4472c4",
            "font_color": "#ffffff",
            "font_weight": "bold",
            "font_style": "normal",
            "font_size": 11
          }
        ]
      },
      "query_text": "Увеличь зарплату на 10% всем у кого стаж не менее 7 лет. Выдели желтым фоном измененные строки",
      "category": "spreadsheet-transformation"
    }
  response: |
    {
      "spreadsheet_data": {
        "metadata": {
          "version": "1.0",
          "created_at": "2025-10-05T09:46:57.309Z"
        },
        "worksheet": {
          "name": "Лист2",
          "range": "A1:I6"
        },
        "data": {
          "header": {
            "values": ["Имя", "Фамилия", "Должность", "Отдел", "Зарплата", "Дата приема", "Возраст", "Образование", "Стаж"],
            "style": "style_2"
          },
          "rows": [
            {
              "values": ["Евгений", "Онегин", "Менеджер", "Продажи", "85000", "12.06.2018", "29", "Магистр", "6"], 
              "style": "style_1"
            },
            {
              "values": ["Анна", "Каренина", "HR‑специалист", "HR", "65000", "03.09.2020", "27", "Бакалавр", "4"],
              "style": "style_1"
            }, 
            {
              "values": ["Родион", "Раскольников", "Финансовый аналитик", "Бухгалтерия", "99000", "17.01.2016", "33", "Магистр", "9"],
              "style": "style_3"
            },
            {
              "values": ["Гарри", "Поттер", "Руководитель проекта", "ИТ", "121000", "27.11.2014", "39", "Доктор наук", "11"],
              "style": "style_3"
            },
            {
              "values": ["Джейн", "Эйр", "UI/UX дизайнер", "Дизайн", "70000", "22.04.2019", "30", "Специалист", "5"],
              "style": "style_1"
            }
          ]
        },
        "columns": [
          {
            "index": 0,
            "format": "General"
          },
          {
            "index": 1,
            "format": "General"
          },
          {
            "index": 2,
            "format": "General"
          },
          {
            "index": 3,
            "format": "General"
          },
          {
            "index": 4,
            "format": "#,##0.00"
          },
          {
            "index": 5,
            "format": "dd/mm/yyyy"
          },
          {
            "index": 6,
            "format": "#,##0"
          },
          {
            "index": 7,
            "format": "General"
          },
          {
            "index": 8,
            "format": "#,##0"
          }
        ],
        "charts": [],
        "styles": [
          {
            "id": "style_1",
            "font_weight": "normal",
            "font_style": "normal",
            "font_size": 11
          },
          {
            "id": "style_2",
            "background_color": "#4472c4",
            "font_color": "#ffffff",
            "font_weight": "bold",
            "font_style": "normal",
            "font_size": 11
          },
          {
            "id": "style_3",
            "background_color": "#ffffff",
            "font_weight": "normal",
            "font_style": "normal",
            "font_size": 11
          }
        ]
      },
      "query_text": "Увеличь зарплату на 10% всем у кого стаж не менее 7 лет. Выдели желтым фоном измененные строки",
      "category": "spreadsheet-transformation"
    }